<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Privacy Policy</title>
    <style>
        :root { --bg:#f7f8fa; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; }
        body { margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg); color:#111827; }
        .wrap { max-width:900px; margin:48px auto; padding:24px; }
        header { display:flex; gap:12px; align-items:center; margin-bottom:18px; }
        h1 { margin:0; font-size:1.25rem; }
        .meta { color:var(--muted); font-size:0.9rem; }
        .card { background:var(--card); border-radius:10px; padding:28px; box-shadow:0 1px 2px rgba(16,24,40,0.04); }
        #content { line-height:1.65; }
        pre, code { background:#0f172a; color:#f8fafc; padding:.15rem .4rem; border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Helvetica Neue", monospace; }
        img { max-width:100%; height:auto; }
        .file-picker { margin-top:12px; color:var(--muted); }
        .error { color:#b91c1c; margin-top:12px; }
        a { color:var(--accent); }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <h1>Privacy Policy</h1>
        </header>

        <div class="card">
            <div id="content">Loading privacy policy…</div>

            <div class="file-picker" id="picker" style="display:none">
                <label>Or open a local file: <input type="file" id="file" accept=".md,text/markdown,text/plain"></label>
            </div>

            <div id="error" class="error" style="display:none"></div>
        </div>
    </div>

    <script>
        (function(){
            const contentEl = document.getElementById('content');
            const pickerEl = document.getElementById('picker');
            const fileInput = document.getElementById('file');
            const errorEl = document.getElementById('error');

            // Try common filenames in order
            const candidates = ['privacy-policy.md','privacy_policy.md','privacy policy.md','PrivacyPolicy.md','privacy.md'];

            async function loadMarkdownText(url){
                const res = await fetch(url);
                if (!res.ok) throw new Error('HTTP '+res.status);
                return res.text();
            }

            async function renderMarkdown(md){
                // load marked and DOMPurify if not present
                if (!window.marked) {
                    await new Promise((resolve, reject)=>{
                        const s = document.createElement('script');
                        s.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
                        s.onload = resolve; s.onerror = reject;
                        document.head.appendChild(s);
                    });
                }
                if (!window.DOMPurify) {
                    await new Promise((resolve, reject)=>{
                        const s = document.createElement('script');
                        s.src = 'https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js';
                        s.onload = resolve; s.onerror = reject;
                        document.head.appendChild(s);
                    });
                }
                const html = window.marked.parse(md || '');
                contentEl.innerHTML = window.DOMPurify.sanitize(html);
            }

            async function attemptLoad(){
                for (const name of candidates){
                    try {
                        const md = await loadMarkdownText(name);
                        await renderMarkdown(md);
                        return;
                    } catch(e){
                        // continue
                    }
                }
                // no file found — show picker
                contentEl.textContent = 'No privacy-policy markdown found in this folder.';
                pickerEl.style.display = '';
                errorEl.style.display = 'none';
            }

            fileInput?.addEventListener('change', async (ev)=>{
                const f = ev.target.files && ev.target.files[0];
                if (!f) return;
                try {
                    const text = await f.text();
                    await renderMarkdown(text);
                    errorEl.style.display = 'none';
                } catch(e){
                    errorEl.textContent = 'Failed to read file: '+(e && e.message || e);
                    errorEl.style.display = '';
                }
            });

            // Start
            attemptLoad();
        })();
    </script>
</body>
</html>